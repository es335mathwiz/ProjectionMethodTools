Get["ProjectionInterface`"];
Get["prep.mth"]

hmatN=hmat//.lucaSubs//myN


augN[nn_Integer]:=
With[{hm1=hmatN[[All,Range[3]]],
hz=hmatN[[All,3+Range[3]]],
hp1=hmatN[[All,6+Range[3]]],
tpZ=ConstantArray[0,{3,nn}],
botZ=ConstantArray[0,{nn-1,3+nn}],
botMidZ=ConstantArray[0,{nn-1,3}],
mdZ=ConstantArray[0,{1,3+nn}],
mdStart={{0,-1,0,1}},mdRght=ConstantArray[0,{1,nn-1}],
preRotate=Join[{-1,1},Table[0,{nn-1}]]
},
With[{tpMat=ArrayFlatten[{{hm1,tpZ,hz,tpZ,hp1,tpZ}}],
mdMat=ArrayFlatten[{{mdZ,mdStart,mdRght,mdZ}}]},
With[{sansBot=ArrayFlatten[{{tpMat},{mdMat}}]},
If[nn==1,sansBot,
With[{postRotate=NestList[RotateRight[#,1]&,preRotate,nn-2]},
With[{bot=ArrayFlatten[{{botZ,botMidZ,postRotate,botZ}}]},
ArrayFlatten[{{tpMat},{mdMat},{bot}}]
]]]]]]

